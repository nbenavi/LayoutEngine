INTSourceChangelist:2390204
Availability:Public
Title:Simplygon LODs
Crumbs: %ROOT%, Engine, Engine/Content, Engine/Content/Types, Engine/Content/Types/StaticMeshes
Description:スタティックメッシュのメッシュの LOD 管理および自動作成用パイプラインとツール

[TOC(start:2)]

## 概要

[REGION:note]
 このページでは、アンリアル エンジン 4 で **スタティックメッシュ** のLOD を作成する Simplygon 機能の使用方法を説明します。Simplygon のライセンスをお持ちでない場合は、標準の FBX パイプラインに **スタティックメッシュ** の LOD のインポート方法があります。詳細は [FBX スタティックメッシュ パイプライン](Engine/Content/FBX/StaticMeshes#スタティックメッシュLOD) ドキュメントを参照してください。
[/REGION]

_スタティックメッシュ_ パイプラインは、 
プリセットを作成し LOD のチェーン一式を自動生成する能力をコア機能として提供します。この機能は、追加作業なしにレンダリングのパフォーマンスを高められるように、 
アーティストがメッシュを作成し、そのメッシュをインポートし、 
さらに、距離でレンダリングできるようにバージョンを最適化することを可能にします。

主な機能は以下の通りです。

* LOD のデフォルト設定、ライトマップ解像度を定義しグローバルなオーバーライドを許可するLOD グループ 
(全ての SmallProp LOD を 10% 減など)。インポート時に LOD グループを選択でき、 
スタティックメッシュ エディタ内で好きな時に変更することができます。
* プラットフォームあるいはデバイスごとに LOD グループ設定の定義およびオーバーライドします。
* 法線とタンジェントは常に FBX からインポートされます。 
インポートした法線/タンジェントを使用するか、またはアンリアルに再計算させるかをいつでも選択することができます。
* LOD の設定および調整に関するワークフローは [スタティックメッシュ エディタ](Engine/Content/Types/StaticMeshes/Editor)をご覧ください。
* Simplygon を用いた LOD の自動生成

[INCLUDE:Engine/UI/Tools/Simplygon#License]

## LOD の管理

**スタティックメッシュ エディタ** の **[LOD]** パネルにより、 [LOD グループ](#LODグループ) 、またはメッシュごとか LOD ベース別かのいずれかの形で、設定したルールに基づいた LOD メッシュのチェーン一式の管理と生成を可能にします。

![Level of Detail Panel](lod_panel.png)

### LOD の生成

自動 LOD 生成では、 [](Engine/UI/Tools/Simplygon) を使って 
ベースメッシュを単純化して作成し LOD として使用します。これらのアルゴリズムでは、目立った劣化やアーティファクトなしに遠くで表示できるメッシュを新たに生成するために 
ターゲットの複雑さ、シルエットの保護、 
テクスチャ座標などの要素が考慮されます。

**LOD Group の適用方法:**

1. [LOD 設定](#LOD設定) で使用すべき **LOD グループ** を選択します。

    ![](group_select.png)

1. ![Apply](button_apply.png) ボタンを押して LOD メッシュを新規作成します。


**カスタム LOD チェーンの生成方法**

1. [LOD 設定](#LOD設定) で生成する LOD メッシュの番号を選択します。

	[REGION:tip]
		**LOD グループ** を開始点として使用するために選択し、後でその設定を変更することもできます。
	[/REGION]

	![](lod_number.png)

1. [削減の設定](#削減の設定 を生成するそれぞれの LOD メッシュに対して設定します。

	![](lod_settings.png)

1. ![Apply](button_apply.png) ボタンを押して LOD メッシュを新規作成します。


### LOD のプレビュー

LOD メッシュはツールバーのコントロールを使用してプレビューすることができます。

![](lod_preview.gif)(convert:false)


###LOD 設定

| 設定 | 説明 |
| ------- | ----------- |
| **LOD グループ** |  [LOD グループ](#LODグループ) のメッシュへの使用を指定します。 |
| **LOD 数** | メッシュに使う LOD の数を設定します。この値が変更されると LOD のリストが更新されますが、 ![Apply](button_apply.png) ボタンが押されるまでは実際の変更は行われません。|
| **Auto compute LOD Distance** | 有効の場合、遷移が LOD 間で生じた距離を判定するためにシンプルな誤差量を使用します。もしくは、いつ遷移がその LOD に生じたのか判定するために、各 LOD に **Distance** プロパティを使用します。
| **LOD Distance Error** | 自動演算を使用している場合、 LOD 間で生じた遷移の距離をスケールします。 |

###ビルド設定

| 設定 | 説明 |
| ------- | ----------- |
| **Recompute Normals** | 有効の場合、スムージング グループがアンリアルにより再計算されます。もしくは、スムージング グループが FBX ファイルから保持されます。|
| **Recompute Tangents** | 有効の場合、タンジェントがアンリアルにより再計算されます。もしくは、タンジェントが FBX ファイルから保持されます。|
| **Remove Degenerates** | 有効になると、インポート中に見つかった縮退トライアングルが削除されます。このオプションを無効にすると、縮退したトライアングルが保持されます。通常、このオプションは有効にしておきます。 |
| **Use Full Precision UVs** | 有効の場合、メッシュの UV は 16 ビットではなく 32 ビット浮動小数点型で保存されます。 |

### 削減の設定

| 設定 | 説明 |
| ------- | ----------- |
| **Percent Triangles** | 指定されたトライアングル数と同じになるまで、エディタはメッシュを簡素化します。 |
| **Max Deviation** | 対バウンディング球比でのベースメッシュからの最大誤差量です。エディタは、メッシュの誤差量を計算するために、 望ましいクオリティの値を使用します。この誤差量は、新たなメッシュがソースとなるメッシュのサーフェスから乖離しすぎるようなメッシュを、ツールが単純化しないようにさせるためのものです。この手法の利点は、任意のトライアングル制限数で止まることなく、ソースとなるメッシュの偏差の範囲内で、ツールがメッシュを自動的に最適化できるという点です。
| **Silhouette** | メッシュのシルエットがどのくらい重要であるかを指定します。_Off (オフ)_ 、 _Lowest (低い)_ 、 _Low (低め)_ 、 _Normal (通常)_ 、 _High (高め)_ 、 _Highest (高い)_ から選択します。より高い設定値を選択すると、単純化において、メッシュのジオメトリ形状がよりよく保存されますが、トライアングル数が多くなります。|
| **Texture** | テクスチャの密度がどのくらい重要であるかを指定します。_Off (オフ)_ 、 _Lowest (低い)_ 、 _Low (低め)_ 、 _Normal (通常)_ 、 _High (高め)_ 、 _Highest (高い)_ から選択します。より高い設定値を選択すると、単純化において、テクスチャの引き伸ばされたアーティファクトを避けることができますが、トライアングル数が多くなります。|
| **Shading** | シェーディング クオリティの重要度を設定します。_Off (オフ)_ 、 _Lowest (低い)_ 、 _Low (低め)_ 、 _Normal (通常)_ 、 _High (高め)_ 、 _Highest (高い)_ から選択します。より高い設定値を選択すると、単純化において、シェーディングのクオリティをより高く維持することができますが、トライアングル数が多くなります。|
| **Welding Threshold** | この距離内にある頂点がお互いに自動結合されます。小さなフェースを排除するのに便利です。大きな値を使用すると望ましくない結果になります。|
| **Hard Edge Angle Threshold** | フェース間の角度がこの値より大きいとフェース間にハードエッジが生じます。角度が小さいとソフトエッジが作成されます。

<!--
[EXCERPT:Type]
完成した LOD メッシュのクオリティもしくは複雑度の判定方法を指定します。

[REGION:simpletable]
| タイプ | 説明 |
| ---- | ----------- |
| **Max Deviation** | 対バウンディング球比でのベースメッシュからの最大誤差量です。エディタは、メッシュの誤差量を計算するために、 望ましいクオリティの値を使用します。この誤差量は、ソースとなるメッシュのサーフェスから新たなメッシュが乖離しすぎるようなメッシュを、ツールが単純化しないようにさせるためのものです。この手法の利点は、任意のトライアングル制限数で止まることなく、ソースとなるメッシュの偏差の範囲内で、ツールがメッシュを自動的に最適化できるという点です。
| **Percent Triangles** | 指定されたトライアングル数と同じになるまで、エディタはメッシュを簡素化します。 |
[/REGION]
[/EXCERPT:Type]
-->

## LOD グループ

LOD グループは、スタティックメッシュにグローバにを変更するオプションのみならずデフォルトの LOD 設定を定義します。 

グループは 「Engine.ini」ファイルの [StaticMeshLODSettings] セクションで定義されます。例:

	[StaticMeshLODSettings]
	LevelArchitecture=(NumLODs=4,LightMapResolution=32,LODPercentTriangles=0.5,SilhouetteImportance=4)
	SmallProp=(NumLODs=4,LODPercentTriangles=0.5)
	LargeProp=(NumLODs=4,LODPercentTriangles=0.5)
	Vista=(NumLODs=1)
	Foliage=(NumLODs=1)

上記の設定により 5 つの LOD グループが定義されます。

* LevelArchitecture
* SmallProp
* LargeProp
* Vista
* フォーリッジ 


LOD グループはコード変更せずに INI を編集するだけで追加と削除ができます。 
追加された LOD グループはエディタUI に自動的に表示されます。 
削除されたグループのメッシュは、コードによって決定されるデフォルト設定を使用します。これらのデフォルト設定もまた、 None LOD group と定義することで INI の中でオーバーライドすることができます。

### グループ デフォルトの設定

以下の設定で、各グループのデフォルトを定義します。これらの設定はメッシュがインポートされているか、 
またはメッシュの LOD グループが変更された時のみ適用されます。

| 設定 | 説明 |
| ------- | ----------- |
| **NumLODs** | 生成する OLD のデフォルト数です。値の範囲は 1～4 です。|
| **LightMapResolution** | 使用するライトマップ解像度です。 |
| **BasePercentTriangles** | ベース LOD 0.0-1.0 で保つトライアングルのパーセンテージです。 |
| **LODPercentTriangles | 各LODを下げるためのトライアングルのパーセンテージ。例えば、 LOD が 4 つあり、 LOD0 が 5000 トライアングルのメッシュに対して0.5 を設定すると、残りの LOD のトライアングル数はそれぞれ 2500、1250、625 となります。 |
| **MaxDeviation** | ローカル空間のベース LOD と LOD のサーフェスとの最大距離です。 |
| **WeldingThreshold** | 2 つの頂点の距離がこの値より小さい場合、それらは結合されます。 |
| **HardAngleThreshold** | 2 つのトライアングル間の角度がこの値 (角度) より大きい場合、この 2 つのトライアングル間のエッジはスムーズではなくなります。 |
| **SilhouetteImportance** | 高めの値を設定すると、 LOD 作成時にオブジェクトのシルエットを維持しようとします。 |
| **TextureImportance** | 高めの値を設定すると、 LOD 作成時にテクスチャの引き伸ばしを防ごうとします。 |
| **ShadingImportance** | 高めの値を設定すると、 LOD 作成時に法線の変更を最小限に抑えようとします。 |

### グループのグロバール設定

グループ内の全てのメッシュを変更するためには、以下の設定を使います。この設定は新規と既存の両方のメッシュに影響を与えます。

| 設定 | 説明 |
| ------- | ----------- |
| **BasePercentTrianglesMult** | ベース LOD を更に減らします。例えば、 0.9 に設定した場合、グループ内の全てのメッシュのベース LOD はトライアングル数を 10% 減らします。 |
| **LODPercentTrianglesMult** | 各 LOD のトライアングル数をさらに減らします。 BasePercentTrianglesMult と似ていますが、ベース LOD には適用しません。 |
| **MaxDeviationBias** | 全てのメッシュに対し削減中に使用された最大誤差量 (max deviation) を調整します。 |
| **WeldingThreshold** | 全てのメッシュに対し削減中使用された結合閾値 (welding threshold) を調整します。 |
| **HardAngleThreshold** | 全てのメッシュに対して削減中使用されたハードアングル閾値 (hard angle threshold) を調整します。 |
| **SilhouetteImportance** | 全てのメッシュに対して削減中使用されたシルエットの重要性 (silhouette importance) を調整します。 |
| **TextureImportance** | 全てのメッシュに対して削減中使用されたテクスチャの重要性 (texture importance) を調整します。 |
| **ShadingImportance** | 全てのメッシュに対して削減中使用されたシェーディングの重要性 (shading importance) を調整します。 |


## Simplygon®

![Simplygon](Engine/UI/Tools/Simplygon/simplygon_logo.png)

「Simmplygon」は、ゲームに適した LOD モデルを自動的に生成するために使用されます。これは、一定のオンスクリーンサイズにおいて、 LOD のクオリティを下げることなく可能な限り多くの情報を削除することによって実現されます。「Simplygon」では、幾何学上の LOD の完全性と LOD 切り替えのビジュアル上のクオリティを保持するプロプライアタリなメッシュ削減メソッドが使用されているため、最上級のゲームの中でそのまま使用でいる AutoLOD (自動 LOD) が作成されます。 

アンリアル・エンジン 4 は、「Simplygon」を利用することによって、アンリアル エディタから出ることなく、ハイクオリティなメッシュ削減を実現しています。開発者は、素早くメッシュを単純化し、 LOD を生成すると、ただちにマップ内でその結果を見ることができます。
